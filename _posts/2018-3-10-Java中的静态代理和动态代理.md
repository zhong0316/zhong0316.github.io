---
layout: post
title: Java中的静态代理和动态代理
categories: [Java]
description: Java中的静态代理和动态代理
keywords: 代理, 静态代理, 动态代理
---

<h1 align="center">Java中的静态代理和动态代理</h1>
## 什么是代理
代理是设计模式的一种，代理类为委托类提供消息预处理，消息转发，事后消息处理等功能。Java中的代理分为三种角色：
1. 代理类(ProxySubject)
2. 委托类(RealSubject)
3. 接口(Subject)

三者关系可以表示如下图:
<div align="center">
    <img src="{{ site.url }}/images/posts/java/代理模式.png" alt="代理模式"/>
</div>

Java中的代理按照代理类生成时机不同又分为静态代理和动态代理。静态代理代理类在编译期就生成，而动态代理代理类则是在Java运行时动态生成。

## 静态代理
Java中的静态代理要求代理类(ProxySubject)和委托类(RealSubject)都实现同一个接口(Subject)。静态代理中代理类在编译期就已经确定，而动态代理则是JVM运行时动态生成，静态代理的效率相对动态代理来说相对高一些，但是静态代理代码冗余大，一单需要修改接口，代理类和委托类都需要修改。
举个例子：

**接口(Subject)**：
```
interface HelloService {
    void sayHello();
}
```
**委托类**：
```
class HelloServiceImpl implements HelloService {
    @Override
    public void sayHello() {
        System.out.println("Hello World!");
    }
}
```
**代理类**：
```
class HelloServiceProxy implements HelloService {
    private HelloService helloService;
    
    public HelloServiceProxy(HelloService helloService) {
        this.helloService = helloService;
    }
    
    @Override
    public void sayHello() {
        System.out.println("Before say hello...");
        helloService.sayHello();
        System.out.println("After say hello...");
    }
}
```
**测试类**：
```
public class HelloServiceTest {
    
    public static void main(String[] args) {
        HelloService helloService = new HelloServiceImpl();
        HelloServiceProxy proxy = new HelloServiceProxy(helloService);
        proxy.sayHello();
    }
}
```
**输出结果**：
```
Before say hello...
Hello World!
After say hello...
```